// Generated by CoffeeScript 1.5.0
(function() {
  var productModule;

  productModule = angular.module('spydrApp.product', ['ngResource']);

  productModule.controller("productGridController", [
    '$scope', 'spydrApp.product.mainService', function($scope, prdService) {
      $scope.products = prdService.getProducts();
      $scope.myData = [];
      $scope.gridOptions = {
        data: 'myData',
        columnDefs: [
          {
            field: 'source',
            displayName: 'Fuente'
          }, {
            field: 'urlV',
            displayName: 'Vendedor'
          }, {
            field: 'itemPrice',
            displayName: 'Precio',
            cellFilter: 'currency:" €"'
          }, {
            field: 'shippingPrice',
            displayName: 'Gasto Envío',
            cellFilter: 'currency:" €"'
          }, {
            field: 'total',
            displayName: 'Precio Final',
            cellFilter: 'currency:" €"'
          }
        ]
      };
      return $scope.updateProductInfo = function() {
        console.log($scope.selectedProductId);
        if ($scope.selectedProductId) {
          return $scope.myData = prdService.getProductBPI($scope.selectedProductId);
        }
      };
    }
  ]);

  productModule.factory('spydrApp.product.mainService', [
    '$http', function($http) {
      return {
        getProducts: function() {
          var products;
          products = [
            {
              id: '3TL941C',
              d: 'Lavadora Carga Superior BALAY 3TL941C'
            }, {
              id: '3TS997',
              d: 'Lavadora Carga Frontal BALAY 3TS997'
            }, {
              id: '3TS84122A',
              d: 'Lavadora Carga Frontal BALAY 3TS84122A'
            }, {
              id: '3TS84102A',
              d: 'Lavadora Carga Frontal BALAY 3TS84102A'
            }, {
              id: '3TS84122X',
              d: 'Lavadora Carga Frontal BALAY 3TS84122X'
            }
          ];
          return products;
        },
        getProductBPI: function(pid) {
          var promise;
          promise = $http.get('/api/1/' + pid).then(function(response) {
            var bpi;
            bpi = response.data.info;
            _.map(bpi, function(item) {
              return item.total = item.itemPrice + item.shippingPrice;
            });
            return bpi;
          });
          return promise;
        }
      };
    }
  ]);

}).call(this);
